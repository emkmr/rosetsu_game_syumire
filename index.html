<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Rosetsu and the Simulated World</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #000;
            overflow: hidden;
            margin: 0;
        }
        
        /* --- Opening Styles --- */
        #openingSequence {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        /* Starry Background */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
        }
        .stars-small {
            background-image: radial-gradient(1px 1px at 20px 30px, #eee, rgba(0,0,0,0)), radial-gradient(1px 1px at 40px 70px, #fff, rgba(0,0,0,0)), radial-gradient(1px 1px at 50px 160px, #ddd, rgba(0,0,0,0)), radial-gradient(1px 1px at 90px 40px, #fff, rgba(0,0,0,0)), radial-gradient(1px 1px at 130px 80px, #fff, rgba(0,0,0,0)), radial-gradient(1px 1px at 160px 120px, #ddd, rgba(0,0,0,0));
            background-size: 200px 200px;
            animation: zoom 25s infinite;
        }
        .stars-medium {
            background-image: radial-gradient(2px 2px at 50px 50px, #fff, rgba(0,0,0,0)), radial-gradient(2px 2px at 100px 100px, #ddd, rgba(0,0,0,0)), radial-gradient(2px 2px at 200px 150px, #fff, rgba(0,0,0,0));
            background-size: 300px 300px;
            animation: zoom 40s infinite;
        }
        @keyframes zoom {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .perspective-container {
            position: absolute;
            width: 100%;
            height: 100%;
            perspective: 400px;
            perspective-origin: 50% 60%;
        }
        .crawl-container {
            position: absolute;
            top: 100%;
            width: 80%;
            max-width: 800px;
            left: 50%;
            transform: translateX(-50%);
            transform-origin: 50% 100%;
            animation: crawl 50s linear forwards;
        }
        .crawl-content {
            color: #feda4a;
            font-size: 5.5vw;
            line-height: 1.4;
            text-align: justify;
            font-weight: bold;
            transform: rotateX(20deg);
        }
        .crawl-episode-title {
            text-align: center;
            font-size: 6vw;
            margin-bottom: 2em;
            line-height: 1.2;
        }
        @media (min-width: 768px) {
            .crawl-content {
                font-size: 42px;
            }
            .crawl-episode-title {
                font-size: 48px;
            }
        }
        @keyframes crawl {
            from { top: 100%; }
            to { top: -200%; }
        }
        .game-title-opening {
            position: absolute;
            top: 50%;
            left: 50%;
            color: #feda4a;
            font-weight: bold;
            text-align: center;
            opacity: 0;
            transform: translate(-50%, -50%) scale(1.5);
            animation: titleZoom 7s forwards;
        }
        .main-title {
            font-size: 10vw;
            white-space: nowrap;
        }
        @media (min-width: 768px) {
            .main-title { font-size: 72px; }
        }
        @keyframes titleZoom {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1.5); }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.1); }
        }
        .initial-text {
            position: absolute;
            top: 50%;
            left: 5%;
            transform: translateY(-50%);
            color: #49dafd;
            font-size: 7vw;
            font-weight: bold;
            text-align: left;
            opacity: 0;
            animation: initialFade 5s forwards;
        }
        @media (min-width: 768px) {
            .initial-text {
                font-size: 3em;
            }
        }
        @keyframes initialFade {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* --- Game Styles --- */
        .game-body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #f0f0f0;
        }
        canvas {
            background-color: #f0f0f0;
            display: block;
            border: 2px solid #333;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            width: 100%;
            height: auto;
        }
        .control-btn {
            transition: all 0.1s ease-in-out;
            user-select: none;
        }
        .control-btn:active {
            transform: scale(0.9);
            background-color: #4a5568;
        }
        .dialogue-box {
            animation: slide-up 0.5s ease-out forwards;
        }
        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="openingSequence">
        <div id="starsContainer" style="display: none;">
            <div class="stars stars-small"></div>
            <div class="stars stars-medium"></div>
        </div>

        <div id="initialText" class="initial-text">
            <p>遠い昔　　はるかかなたの</p>
            <p>銀河系で・・・</p>
        </div>
        <div id="gameTitleOpening" class="game-title-opening" style="display: none;">
            <p class="main-title">Rosetsu and the Simulated World</p>
        </div>
        <div id="perspectiveContainer" class="perspective-container" style="display: none;">
            <div id="crawlContainer" class="crawl-container">
                <div class="crawl-content">
                    <h3 class="crawl-episode-title">エピソード４<br>新たなる覚醒</h3>
                    <p>もし、あなたの信じる日常が、偽りだとしたら？</p>
                    <p>&nbsp;</p> 
                    <p>それは、食べてもなくならないドッグフードから始まった。小さな違和感は、やがて世界の真実へと繋がる。一匹のチワワが、世界の運命をその鼻先に委ねられる。</p>
                    <p>&nbsp;</p> 
                    <p>白いチワワの男の子「ロセツ」。彼の日常は、温かい家族と優しい時間で満たされているはずだった。</p>
                    <p>&nbsp;</p> 
                    <p>しかし、その生まれつき鋭すぎる嗅覚と聴覚は、人間には決して気づけない世界の“ノイズ”を拾ってしまう。木の中から聞こえるはずのない電子音、昨日まで存在しなかった公園のブランコ、そして、何度食べても満たされることのない不思議なドッグフード。</p>
                    <p>&nbsp;</p> 
                    <p>それらはすべて、この世界が精巧なシミュレーションであり、今まさに崩壊の危機にあることを示す「バグ」だった。</p>
                    <p>&nbsp;</p> 
                    <p>このまま綻びが広がれば、大好きな家族の笑顔も、共に過ごした温かい記憶も、すべてがエラーコードの彼方に消えてしまうかもしれない。</p>
                    <p>&nbsp;</p> 
                    <p>ロセツは小さな胸に決意を秘める。</p>
                    <p>家族との平和な日常を守るため、この世界の真実を突き止め、すべての「綻び」を修復する冒険に出ることを。</p>
                </div>
            </div>
        </div>
    </div>

    <div id="mainGame" style="display: none;" class="flex flex-col items-center justify-center min-h-screen p-4">
        <div id="game-container" class="w-full max-w-2xl mx-auto">
            <h1 class="text-2xl font-bold text-center text-gray-800 mb-4">Rosetsu and the Simulated World</h1>
            <canvas id="gameCanvas"></canvas>
        </div>
        <div id="dialogue-container" class="fixed bottom-0 left-0 right-0 p-4 flex justify-center z-10"></div>
        <div id="controls" class="mt-4 grid grid-cols-3 gap-2 w-full max-w-xs">
            <div></div>
            <button id="btn-up" class="control-btn bg-gray-400 text-white p-4 rounded-lg shadow-md">↑</button>
            <div></div>
            <button id="btn-left" class="control-btn bg-gray-400 text-white p-4 rounded-lg shadow-md">←</button>
            <button id="btn-down" class="control-btn bg-gray-400 text-white p-4 rounded-lg shadow-md">↓</button>
            <button id="btn-right" class="control-btn bg-gray-400 text-white p-4 rounded-lg shadow-md">→</button>
            <button id="btn-action" class="control-btn bg-lime-400 text-white p-4 rounded-lg shadow-md col-span-3">TALK / CHECK</button>
        </div>
    </div>

    <script>
        // --- Opening Sequence Logic ---
        const initialText = document.getElementById('initialText');
        const gameTitleOpening = document.getElementById('gameTitleOpening');
        const perspectiveContainer = document.getElementById('perspectiveContainer');
        const crawlContainer = document.getElementById('crawlContainer');
        const openingSequence = document.getElementById('openingSequence');
        const mainGame = document.getElementById('mainGame');
        const starsContainer = document.getElementById('starsContainer');
        
        let openingSkipped = false;
        function skipOpening() {
            if (openingSkipped) return;
            openingSkipped = true;

            openingSequence.style.display = 'none';
            document.body.classList.add('game-body');
            mainGame.style.display = 'flex';
            window.startGame();
        }

        openingSequence.addEventListener('click', skipOpening);
        openingSequence.addEventListener('touchstart', skipOpening);

        initialText.addEventListener('animationend', () => {
            if (openingSkipped) return;
            initialText.style.display = 'none';
            starsContainer.style.display = 'block'; // Show stars with the title
            gameTitleOpening.style.display = 'block';
        });